<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12 Combine biomarker trajectory extracted from from UKB and PCP data | UK Biobank Phenotyping</title>
  <meta name="description" content="12 Combine biomarker trajectory extracted from from UKB and PCP data | UK Biobank Phenotyping" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="12 Combine biomarker trajectory extracted from from UKB and PCP data | UK Biobank Phenotyping" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12 Combine biomarker trajectory extracted from from UKB and PCP data | UK Biobank Phenotyping" />
  
  
  

<meta name="author" content="Do Hyun Kim" />


<meta name="date" content="2023-01-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="11.14-reformat-and-trim-trajectory-table-for-each-biomarker.html"/>
<link rel="next" href="13-phenotype-outcome-combine.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#generating-time-to-event-data-using-uk-biobank-data" id="toc-generating-time-to-event-data-using-uk-biobank-data">Generating time-to-event data using UK biobank data</a></li>
<li><a href="1-reformat-raw-data.html#reformat-raw-data" id="toc-reformat-raw-data"><span class="toc-section-number">1</span> Clean raw UKB assesment center data</a></li>
<li><a href="2-curate-demog-table.html#curate-demog-table" id="toc-curate-demog-table"><span class="toc-section-number">2</span> Curate demographic table</a></li>
<li><a href="3-curate-master-ukb-events-table.html#curate-master-ukb-events-table" id="toc-curate-master-ukb-events-table"><span class="toc-section-number">3</span> Curate a master UKB event table</a>
<ul>
<li><a href="3.1-first-occurrence-event-table-and-algorithmically-defined-outcome-table.html#first-occurrence-event-table-and-algorithmically-defined-outcome-table" id="toc-first-occurrence-event-table-and-algorithmically-defined-outcome-table"><span class="toc-section-number">3.1</span> First occurrence event table and algorithmically defined outcome table</a></li>
<li><a href="3.2-custom-defined-outcome-for-dr.html#custom-defined-outcome-for-dr" id="toc-custom-defined-outcome-for-dr"><span class="toc-section-number">3.2</span> Custom defined outcome for DR</a></li>
<li><a href="3.3-icd-9-10.html#icd-9-10" id="toc-icd-9-10"><span class="toc-section-number">3.3</span> ICD 9 &amp; 10</a></li>
<li><a href="3.4-opcs4.html#opcs4" id="toc-opcs4"><span class="toc-section-number">3.4</span> OPCS4</a></li>
<li><a href="3.5-self-reported-conditions.html#self-reported-conditions" id="toc-self-reported-conditions"><span class="toc-section-number">3.5</span> Self-reported conditions</a></li>
<li><a href="3.6-self-reported-operations.html#self-reported-operations" id="toc-self-reported-operations"><span class="toc-section-number">3.6</span> Self-reported operations</a></li>
<li><a href="3.7-standardize-and-merge-event-tables.html#standardize-and-merge-event-tables" id="toc-standardize-and-merge-event-tables"><span class="toc-section-number">3.7</span> Standardize and merge event tables</a></li>
<li><a href="3.8-convert-ukb-special-dates-into-normal-dates.html#convert-ukb-special-dates-into-normal-dates" id="toc-convert-ukb-special-dates-into-normal-dates"><span class="toc-section-number">3.8</span> Convert UKB special dates into “normal” dates</a></li>
</ul></li>
<li><a href="4-exclude-sex-mismatch-subjects.html#exclude-sex-mismatch-subjects" id="toc-exclude-sex-mismatch-subjects"><span class="toc-section-number">4</span> Filter out subjects with sex mismatch</a></li>
<li><a href="5-prep-pcp-data.html#prep-pcp-data" id="toc-prep-pcp-data"><span class="toc-section-number">5</span> Prepare UKB Primary Care Data</a></li>
<li><a href="6-make-code-dictionary.html#make-code-dictionary" id="toc-make-code-dictionary"><span class="toc-section-number">6</span> Create a master code dictionary for primary care data</a></li>
<li><a href="7-make-outcome-specific-code-dictionary.html#make-outcome-specific-code-dictionary" id="toc-make-outcome-specific-code-dictionary"><span class="toc-section-number">7</span> Make outcome-specific code dictionary</a>
<ul>
<li><a href="7.1-prepare-diabetes-code-dictionary.html#prepare-diabetes-code-dictionary" id="toc-prepare-diabetes-code-dictionary"><span class="toc-section-number">7.1</span> Prepare diabetes code dictionary</a>
<ul>
<li><a href="7.1-prepare-diabetes-code-dictionary.html#define-keywords" id="toc-define-keywords"><span class="toc-section-number">7.1.1</span> Define keywords</a></li>
<li><a href="7.1-prepare-diabetes-code-dictionary.html#define-codes" id="toc-define-codes"><span class="toc-section-number">7.1.2</span> Define codes</a></li>
<li><a href="7.1-prepare-diabetes-code-dictionary.html#create-diabetes-code-dictionary" id="toc-create-diabetes-code-dictionary"><span class="toc-section-number">7.1.3</span> Create diabetes code dictionary</a></li>
</ul></li>
<li><a href="7.2-prepare-diabetic-eye-disease-code-dictionary.html#prepare-diabetic-eye-disease-code-dictionary" id="toc-prepare-diabetic-eye-disease-code-dictionary"><span class="toc-section-number">7.2</span> Prepare diabetic eye disease code dictionary</a>
<ul>
<li><a href="7.2-prepare-diabetic-eye-disease-code-dictionary.html#define-keywords-1" id="toc-define-keywords-1"><span class="toc-section-number">7.2.1</span> Define keywords</a></li>
<li><a href="7.2-prepare-diabetic-eye-disease-code-dictionary.html#define-codes-1" id="toc-define-codes-1"><span class="toc-section-number">7.2.2</span> Define codes</a></li>
<li><a href="7.2-prepare-diabetic-eye-disease-code-dictionary.html#create-diabetic-eye-disease-code-dictionary" id="toc-create-diabetic-eye-disease-code-dictionary"><span class="toc-section-number">7.2.3</span> Create diabetic eye disease code dictionary</a></li>
</ul></li>
<li><a href="7.3-prepare-diabetic-kidney-disease-code-dictionary.html#prepare-diabetic-kidney-disease-code-dictionary" id="toc-prepare-diabetic-kidney-disease-code-dictionary"><span class="toc-section-number">7.3</span> Prepare diabetic kidney disease code dictionary</a>
<ul>
<li><a href="7.3-prepare-diabetic-kidney-disease-code-dictionary.html#define-keywords-2" id="toc-define-keywords-2"><span class="toc-section-number">7.3.1</span> Define Keywords</a></li>
<li><a href="7.3-prepare-diabetic-kidney-disease-code-dictionary.html#define-codes-2" id="toc-define-codes-2"><span class="toc-section-number">7.3.2</span> Define codes</a></li>
<li><a href="7.3-prepare-diabetic-kidney-disease-code-dictionary.html#create-diabetic-kidney-disease-code-dictionary" id="toc-create-diabetic-kidney-disease-code-dictionary"><span class="toc-section-number">7.3.3</span> Create diabetic kidney disease code dictionary</a></li>
</ul></li>
</ul></li>
<li><a href="8-phenotype-outcomes-ukb.html#phenotype-outcomes-ukb" id="toc-phenotype-outcomes-ukb"><span class="toc-section-number">8</span> Phenotype outcome and control exclusion events using UKB assessment center data</a>
<ul>
<li><a href="8.1-phenotype-outcomes.html#phenotype-outcomes" id="toc-phenotype-outcomes"><span class="toc-section-number">8.1</span> Phenotype outcomes</a>
<ul>
<li><a href="8.1-phenotype-outcomes.html#dm" id="toc-dm"><span class="toc-section-number">8.1.1</span> DM</a></li>
<li><a href="8.1-phenotype-outcomes.html#mi" id="toc-mi"><span class="toc-section-number">8.1.2</span> MI</a></li>
<li><a href="8.1-phenotype-outcomes.html#unstable-angina" id="toc-unstable-angina"><span class="toc-section-number">8.1.3</span> Unstable Angina</a></li>
<li><a href="8.1-phenotype-outcomes.html#ischemic-stroke" id="toc-ischemic-stroke"><span class="toc-section-number">8.1.4</span> Ischemic Stroke</a></li>
<li><a href="8.1-phenotype-outcomes.html#hemorrhagic-stroke" id="toc-hemorrhagic-stroke"><span class="toc-section-number">8.1.5</span> Hemorrhagic Stroke</a></li>
<li><a href="8.1-phenotype-outcomes.html#stroke" id="toc-stroke"><span class="toc-section-number">8.1.6</span> Stroke</a></li>
<li><a href="8.1-phenotype-outcomes.html#pci" id="toc-pci"><span class="toc-section-number">8.1.7</span> PCI</a></li>
<li><a href="8.1-phenotype-outcomes.html#cvd-death" id="toc-cvd-death"><span class="toc-section-number">8.1.8</span> CVD death</a></li>
<li><a href="8.1-phenotype-outcomes.html#composite-cvd" id="toc-composite-cvd"><span class="toc-section-number">8.1.9</span> Composite CVD</a></li>
<li><a href="8.1-phenotype-outcomes.html#dr" id="toc-dr"><span class="toc-section-number">8.1.10</span> DR</a></li>
<li><a href="8.1-phenotype-outcomes.html#dkd" id="toc-dkd"><span class="toc-section-number">8.1.11</span> DKD</a></li>
</ul></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#phenotype-control-exclusion-events" id="toc-phenotype-control-exclusion-events"><span class="toc-section-number">8.2</span> Phenotype control exclusion events</a>
<ul>
<li><a href="8.2-phenotype-control-exclusion-events.html#cardiovascular-control-exclusion-events" id="toc-cardiovascular-control-exclusion-events"><span class="toc-section-number">8.2.1</span> Cardiovascular control exclusion events</a></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#cerebrovascular-control-exclusion-events" id="toc-cerebrovascular-control-exclusion-events"><span class="toc-section-number">8.2.2</span> Cerebrovascular control exclusion events</a></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#non-coronary-revascularization-procedure-control-exclusion-events" id="toc-non-coronary-revascularization-procedure-control-exclusion-events"><span class="toc-section-number">8.2.3</span> Non-coronary revascularization procedure control exclusion events</a></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#renal-disease-control-exclusion-events" id="toc-renal-disease-control-exclusion-events"><span class="toc-section-number">8.2.4</span> Renal disease control exclusion events</a></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#eye-disease-control-exclusion-events" id="toc-eye-disease-control-exclusion-events"><span class="toc-section-number">8.2.5</span> Eye disease control exclusion events</a></li>
</ul></li>
</ul></li>
<li><a href="9-phenotype-outcomes-pcp.html#phenotype-outcomes-pcp" id="toc-phenotype-outcomes-pcp"><span class="toc-section-number">9</span> Phenotype outcomes using primary care data</a>
<ul>
<li><a href="9.1-phenotype-outcome-events.html#phenotype-outcome-events" id="toc-phenotype-outcome-events"><span class="toc-section-number">9.1</span> Phenotype outcome events</a>
<ul>
<li><a href="9.1-phenotype-outcome-events.html#dm-1" id="toc-dm-1"><span class="toc-section-number">9.1.1</span> DM</a></li>
<li><a href="9.1-phenotype-outcome-events.html#dr-1" id="toc-dr-1"><span class="toc-section-number">9.1.2</span> DR</a></li>
<li><a href="9.1-phenotype-outcome-events.html#dkd-1" id="toc-dkd-1"><span class="toc-section-number">9.1.3</span> DKD</a></li>
</ul></li>
<li><a href="9.2-phenotype-control-exclusion-events-1.html#phenotype-control-exclusion-events-1" id="toc-phenotype-control-exclusion-events-1"><span class="toc-section-number">9.2</span> Phenotype control exclusion events</a>
<ul>
<li><a href="9.2-phenotype-control-exclusion-events-1.html#non-diabetic-eye-disease-events" id="toc-non-diabetic-eye-disease-events"><span class="toc-section-number">9.2.1</span> Non-diabetic eye disease events</a></li>
<li><a href="9.2-phenotype-control-exclusion-events-1.html#kidney-disease-control-exclusion-events" id="toc-kidney-disease-control-exclusion-events"><span class="toc-section-number">9.2.2</span> Kidney disease control exclusion events</a></li>
</ul></li>
</ul></li>
<li><a href="10-traj-ukb.html#traj-ukb" id="toc-traj-ukb"><span class="toc-section-number">10</span> Create biomarker trajectory data from UK biobank assessment center data</a></li>
<li><a href="11-traj-pcp.html#traj-pcp" id="toc-traj-pcp"><span class="toc-section-number">11</span> Create biomarker trajectory data from primary care data</a>
<ul>
<li><a href="11.1-total-cholesterol.html#total-cholesterol" id="toc-total-cholesterol"><span class="toc-section-number">11.1</span> Total cholesterol</a></li>
<li><a href="11.2-hdl.html#hdl" id="toc-hdl"><span class="toc-section-number">11.2</span> HDL</a></li>
<li><a href="11.3-ldl.html#ldl" id="toc-ldl"><span class="toc-section-number">11.3</span> LDL</a></li>
<li><a href="11.4-triglycerides.html#triglycerides" id="toc-triglycerides"><span class="toc-section-number">11.4</span> Triglycerides</a></li>
<li><a href="11.5-fasting-glucose.html#fasting-glucose" id="toc-fasting-glucose"><span class="toc-section-number">11.5</span> Fasting Glucose</a></li>
<li><a href="11.6-random-glucose.html#random-glucose" id="toc-random-glucose"><span class="toc-section-number">11.6</span> Random glucose</a></li>
<li><a href="11.7-urine-albumin.html#urine-albumin" id="toc-urine-albumin"><span class="toc-section-number">11.7</span> Urine Albumin</a></li>
<li><a href="11.8-urine-creatinine.html#urine-creatinine" id="toc-urine-creatinine"><span class="toc-section-number">11.8</span> Urine creatinine</a></li>
<li><a href="11.9-urine-acr-albumincreatinine-ratio.html#urine-acr-albumincreatinine-ratio" id="toc-urine-acr-albumincreatinine-ratio"><span class="toc-section-number">11.9</span> Urine ACR (Albumin:Creatinine Ratio)</a></li>
<li><a href="11.10-bloodserum-creatinine.html#bloodserum-creatinine" id="toc-bloodserum-creatinine"><span class="toc-section-number">11.10</span> Blood/Serum creatinine</a></li>
<li><a href="11.11-hba1c.html#hba1c" id="toc-hba1c"><span class="toc-section-number">11.11</span> HbA1c</a></li>
<li><a href="11.12-bmi.html#bmi" id="toc-bmi"><span class="toc-section-number">11.12</span> BMI</a></li>
<li><a href="11.13-blood-pressure.html#blood-pressure" id="toc-blood-pressure"><span class="toc-section-number">11.13</span> Blood Pressure</a></li>
<li><a href="11.14-reformat-and-trim-trajectory-table-for-each-biomarker.html#reformat-and-trim-trajectory-table-for-each-biomarker" id="toc-reformat-and-trim-trajectory-table-for-each-biomarker"><span class="toc-section-number">11.14</span> Reformat and trim trajectory table for each biomarker</a></li>
</ul></li>
<li><a href="12-traj-combine.html#traj-combine" id="toc-traj-combine"><span class="toc-section-number">12</span> Combine biomarker trajectory extracted from from UKB and PCP data</a></li>
<li><a href="13-phenotype-outcome-combine.html#phenotype-outcome-combine" id="toc-phenotype-outcome-combine"><span class="toc-section-number">13</span> Phenotype outcomes using combination of tables</a></li>
<li><a href="14-tte-macro.html#tte-macro" id="toc-tte-macro"><span class="toc-section-number">14</span> Generate time-to-event data for macrovascular diabetes complications</a></li>
<li><a href="15-tte-dr.html#tte-dr" id="toc-tte-dr"><span class="toc-section-number">15</span> Generate time-to-event data for diabetic eye disease</a></li>
<li><a href="16-tte-dkd.html#tte-dkd" id="toc-tte-dkd"><span class="toc-section-number">16</span> Generate time-to-event data for diabetes related kidney disease</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">UK Biobank Phenotyping</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="traj-combine" class="section level1" number="12">
<h1><span class="header-section-number">12</span> Combine biomarker trajectory extracted from from UKB and PCP data</h1>
<p>In the previous chapters <a href="10-traj-ukb.html#traj-ukb">10</a> and <a href="11-traj-pcp.html#traj-pcp">11</a>, we have created trajectory data for various biomarkers along with macroalbumuminuria or microalbuminuria status. In this chapter, we combine these data to produce the master trajectory data, first occurrence microalbmuinuria event table and first occurrence macroalbuminuria event table. Furthermore, using blood creatinine trajectory data, we phenotype egfr trajectory data which will be used to create prolonged low egfr first occurrence table. The first occurrence macroalbuminuria event table and prolonged low egfr first occurrence table will be used to additionally capture diabetic kidney disease cases, and the first occurrence microalbuminuria event table will be used to phenotype time-to-event data for DKD in chapter <a href="16-tte-dkd.html#tte-dkd">16</a>.</p>
<p>Load packages and functions.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="12-traj-combine.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb233-2"><a href="12-traj-combine.html#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;functions.R&quot;</span>)</span></code></pre></div>
<p>Load UKB and PCP biomarker trajectory data.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="12-traj-combine.html#cb234-1" aria-hidden="true" tabindex="-1"></a>biomarker_traj_pcp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/biomarker_trajectory_pcp.RDS&quot;</span>)</span>
<span id="cb234-2"><a href="12-traj-combine.html#cb234-2" aria-hidden="true" tabindex="-1"></a>biomarker_traj_ukb <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/biomarker_trajectory_ukb.RDS&quot;</span>)</span></code></pre></div>
<p>Combine UKB and PCP biomarker trajectory data.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="12-traj-combine.html#cb235-1" aria-hidden="true" tabindex="-1"></a>biomarker_traj <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(biomarker_traj_pcp,biomarker_traj_ukb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>visit))</span>
<span id="cb235-2"><a href="12-traj-combine.html#cb235-2" aria-hidden="true" tabindex="-1"></a>biomarker_traj <span class="ot">&lt;-</span> biomarker_traj <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<p>Load UKB and PCP albuminuria event table.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="12-traj-combine.html#cb236-1" aria-hidden="true" tabindex="-1"></a>albuminuria_event_tab_pcp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/albuminuria_event_tab_pcp.RDS&quot;</span>)</span>
<span id="cb236-2"><a href="12-traj-combine.html#cb236-2" aria-hidden="true" tabindex="-1"></a>albuminuria_event_tab_ukb <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/albuminuria_event_tab_ukb.RDS&quot;</span>)</span></code></pre></div>
<p>Combine albuminuria event tables.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="12-traj-combine.html#cb237-1" aria-hidden="true" tabindex="-1"></a>albuminuria_event_tab <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(albuminuria_event_tab_pcp,albuminuria_event_tab_ukb) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span></code></pre></div>
<p>Create micro and microalbuminuria first identification event table.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="12-traj-combine.html#cb238-1" aria-hidden="true" tabindex="-1"></a>microabu_firstoccur <span class="ot">&lt;-</span> albuminuria_event_tab <span class="sc">%&gt;%</span> </span>
<span id="cb238-2"><a href="12-traj-combine.html#cb238-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;microalbuminuria&quot;</span>,event <span class="sc">==</span> T) <span class="sc">%&gt;%</span> <span class="fu">select</span>(f.eid,event,event_dt) <span class="sc">%&gt;%</span></span>
<span id="cb238-3"><a href="12-traj-combine.html#cb238-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(f.eid) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(event_dt) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb238-4"><a href="12-traj-combine.html#cb238-4" aria-hidden="true" tabindex="-1"></a>macroabu_firstoccur <span class="ot">&lt;-</span> albuminuria_event_tab <span class="sc">%&gt;%</span> </span>
<span id="cb238-5"><a href="12-traj-combine.html#cb238-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;macroalbuminuria&quot;</span>,event <span class="sc">==</span> T) <span class="sc">%&gt;%</span> <span class="fu">select</span>(f.eid,event,event_dt) <span class="sc">%&gt;%</span></span>
<span id="cb238-6"><a href="12-traj-combine.html#cb238-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(f.eid) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(event_dt) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div>
<p>Load the demographic table.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="12-traj-combine.html#cb239-1" aria-hidden="true" tabindex="-1"></a>demog <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/demog_selected.RDS&quot;</span>)</span></code></pre></div>
<p>Compute eGFR and create eGFR trajectory data.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="12-traj-combine.html#cb240-1" aria-hidden="true" tabindex="-1"></a>creat_blood_traj <span class="ot">&lt;-</span> biomarker_traj[biomarker_traj<span class="sc">$</span>biomarker <span class="sc">==</span> <span class="st">&quot;creat_blood&quot;</span>,] <span class="sc">%&gt;%</span></span>
<span id="cb240-2"><a href="12-traj-combine.html#cb240-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(demog <span class="sc">%&gt;%</span> <span class="fu">select</span>(f.eid, SEX, DOB))</span>
<span id="cb240-3"><a href="12-traj-combine.html#cb240-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-4"><a href="12-traj-combine.html#cb240-4" aria-hidden="true" tabindex="-1"></a>creat_blood_traj<span class="sc">$</span>age_egfr <span class="ot">&lt;-</span></span>
<span id="cb240-5"><a href="12-traj-combine.html#cb240-5" aria-hidden="true" tabindex="-1"></a>  lubridate<span class="sc">::</span><span class="fu">decimal_date</span>(creat_blood_traj<span class="sc">$</span>event_dt) <span class="sc">-</span> lubridate<span class="sc">::</span><span class="fu">decimal_date</span>(creat_blood_traj<span class="sc">$</span>DOB)</span>
<span id="cb240-6"><a href="12-traj-combine.html#cb240-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-7"><a href="12-traj-combine.html#cb240-7" aria-hidden="true" tabindex="-1"></a>creat_blood_traj<span class="sc">$</span>measurement_egfr <span class="ot">&lt;-</span></span>
<span id="cb240-8"><a href="12-traj-combine.html#cb240-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapply</span>(compute_egfr,creat_blood_traj<span class="sc">$</span>measurement,creat_blood_traj<span class="sc">$</span>age_egfr,creat_blood_traj<span class="sc">$</span>SEX)</span>
<span id="cb240-9"><a href="12-traj-combine.html#cb240-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-10"><a href="12-traj-combine.html#cb240-10" aria-hidden="true" tabindex="-1"></a>egfr_traj <span class="ot">&lt;-</span> creat_blood_traj <span class="sc">%&gt;%</span> <span class="fu">select</span>(f.eid,measurement_egfr,event_dt) <span class="sc">%&gt;%</span></span>
<span id="cb240-11"><a href="12-traj-combine.html#cb240-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">measurement =</span> measurement_egfr) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">biomarker =</span> <span class="st">&quot;egfr&quot;</span>)</span>
<span id="cb240-12"><a href="12-traj-combine.html#cb240-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-13"><a href="12-traj-combine.html#cb240-13" aria-hidden="true" tabindex="-1"></a>egfr_traj <span class="ot">&lt;-</span> egfr_traj[<span class="sc">!</span><span class="fu">is.na</span>(egfr_traj<span class="sc">$</span>measurement),]</span></code></pre></div>
<p>Define a “prolonged low eGFR event” as as an event with two or more low eGFR event (eGFR &lt; 60) for more than 90 days without a normal eGFR in between (which can be ascertained only when we have at least two low eGFR event 90 days apart). <code>low_egfr_firstoccur</code> contains the first occurrence date of the “prolonged low eGFR event.” This event table will be used in phenotyping DKD cases later.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="12-traj-combine.html#cb241-1" aria-hidden="true" tabindex="-1"></a>prolonged_low_egfr_firstoccur <span class="ot">&lt;-</span> egfr_traj <span class="sc">%&gt;%</span> </span>
<span id="cb241-2"><a href="12-traj-combine.html#cb241-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">eGFR_lt60 =</span> <span class="fu">ifelse</span>(measurement <span class="sc">&lt;</span> <span class="dv">60</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb241-3"><a href="12-traj-combine.html#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(f.eid) <span class="sc">%&gt;%</span></span>
<span id="cb241-4"><a href="12-traj-combine.html#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(f.eid, event_dt) <span class="sc">%&gt;%</span></span>
<span id="cb241-5"><a href="12-traj-combine.html#cb241-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">switched =</span> eGFR_lt60 <span class="sc">!=</span> <span class="fu">lag</span>(eGFR_lt60)) <span class="sc">%&gt;%</span></span>
<span id="cb241-6"><a href="12-traj-combine.html#cb241-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">run_n =</span> <span class="fu">cumsum</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(switched), <span class="dv">0</span>, switched))) <span class="sc">%&gt;%</span></span>
<span id="cb241-7"><a href="12-traj-combine.html#cb241-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(f.eid, run_n) <span class="sc">%&gt;%</span> </span>
<span id="cb241-8"><a href="12-traj-combine.html#cb241-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">max_days =</span> </span>
<span id="cb241-9"><a href="12-traj-combine.html#cb241-9" aria-hidden="true" tabindex="-1"></a>             (lubridate<span class="sc">::</span><span class="fu">decimal_date</span>(<span class="fu">max</span>(event_dt, <span class="at">na.rm=</span>T)) <span class="sc">-</span> </span>
<span id="cb241-10"><a href="12-traj-combine.html#cb241-10" aria-hidden="true" tabindex="-1"></a>                lubridate<span class="sc">::</span><span class="fu">decimal_date</span>(<span class="fu">min</span>(event_dt, <span class="at">na.rm=</span>T)))<span class="sc">*</span><span class="fl">365.25</span>) <span class="sc">%&gt;%</span></span>
<span id="cb241-11"><a href="12-traj-combine.html#cb241-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(eGFR_lt60 <span class="sc">&amp;</span> max_days <span class="sc">&gt;=</span><span class="dv">90</span>) <span class="sc">%&gt;%</span> <span class="co"># for a subject with only one event of egfr &lt; 60, then we would have max_days = 0</span></span>
<span id="cb241-12"><a href="12-traj-combine.html#cb241-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb241-13"><a href="12-traj-combine.html#cb241-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(f.eid) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(event_dt) <span class="sc">%&gt;%</span></span>
<span id="cb241-14"><a href="12-traj-combine.html#cb241-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="co"># selecting for the start date of the first period where a subject had egfr level less 60 for </span></span>
<span id="cb241-15"><a href="12-traj-combine.html#cb241-15" aria-hidden="true" tabindex="-1"></a>                                  <span class="co"># 90+ days.</span></span>
<span id="cb241-16"><a href="12-traj-combine.html#cb241-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(f.eid, event_dt)</span></code></pre></div>
<p>Add eGFR trajectory data to <code>biomarker_traj</code>.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="12-traj-combine.html#cb242-1" aria-hidden="true" tabindex="-1"></a>biomarker_traj <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(biomarker_traj,egfr_traj)</span>
<span id="cb242-2"><a href="12-traj-combine.html#cb242-2" aria-hidden="true" tabindex="-1"></a>biomarker_traj <span class="ot">&lt;-</span> biomarker_traj[<span class="sc">!</span><span class="fu">is.na</span>(biomarker_traj<span class="sc">$</span>measurement) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(biomarker_traj<span class="sc">$</span>event_dt),]</span></code></pre></div>
<p>Break up biomarker trajectory table per biomarker.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="12-traj-combine.html#cb243-1" aria-hidden="true" tabindex="-1"></a>biomarker_traj_list_per_biomarker <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">unique</span>(biomarker_traj<span class="sc">$</span>biomarker),<span class="cf">function</span>(biomarker){</span>
<span id="cb243-2"><a href="12-traj-combine.html#cb243-2" aria-hidden="true" tabindex="-1"></a>  biomarker_traj[biomarker_traj<span class="sc">$</span>biomarker <span class="sc">==</span> biomarker,]</span>
<span id="cb243-3"><a href="12-traj-combine.html#cb243-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb243-4"><a href="12-traj-combine.html#cb243-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(biomarker_traj_list_per_biomarker) <span class="ot">&lt;-</span> <span class="fu">unique</span>(biomarker_traj<span class="sc">$</span>biomarker)</span></code></pre></div>
<p>Save biomarker trajectory table.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="12-traj-combine.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(biomarker_traj,<span class="st">&quot;generated_data/biomarker_trajectory.RDS&quot;</span>)</span></code></pre></div>
<p>Save trajectory table for each biomarker.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="12-traj-combine.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(biomarker_traj_list_per_biomarker)){</span>
<span id="cb245-2"><a href="12-traj-combine.html#cb245-2" aria-hidden="true" tabindex="-1"></a>    biomarker <span class="ot">&lt;-</span> <span class="fu">names</span>(biomarker_traj_list_per_biomarker)[i]</span>
<span id="cb245-3"><a href="12-traj-combine.html#cb245-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveRDS</span>(biomarker_traj_list_per_biomarker[[i]],<span class="fu">paste0</span>(<span class="st">&quot;generated_data/&quot;</span>,<span class="st">&quot;trajectory_&quot;</span>,biomarker,<span class="st">&quot;.RDS&quot;</span>))</span>
<span id="cb245-4"><a href="12-traj-combine.html#cb245-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Save albuminuria table.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="12-traj-combine.html#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(albuminuria_event_tab,<span class="st">&quot;generated_data/albuminuria_event_tab.RDS&quot;</span>)</span></code></pre></div>
<p>Save macroalbuminuria and microalbuminuria first occurrence table.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="12-traj-combine.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(macroabu_firstoccur,<span class="st">&quot;generated_data/macroabu_firstoccur.RDS&quot;</span>)</span>
<span id="cb247-2"><a href="12-traj-combine.html#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(microabu_firstoccur,<span class="st">&quot;generated_data/microabu_firstoccur.RDS&quot;</span>)</span></code></pre></div>
<p>Save prolonged low eGFR first occurrence table.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="12-traj-combine.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(prolonged_low_egfr_firstoccur,<span class="st">&quot;generated_data/prolonged_low_egfr_firstoccur.RDS&quot;</span>)</span></code></pre></div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="11.14-reformat-and-trim-trajectory-table-for-each-biomarker.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="13-phenotype-outcome-combine.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
