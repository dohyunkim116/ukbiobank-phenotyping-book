<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>14 Generate time-to-event data for macrovascular diabetes complications | UK Biobank Phenotyping</title>
  <meta name="description" content="14 Generate time-to-event data for macrovascular diabetes complications | UK Biobank Phenotyping" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="14 Generate time-to-event data for macrovascular diabetes complications | UK Biobank Phenotyping" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14 Generate time-to-event data for macrovascular diabetes complications | UK Biobank Phenotyping" />
  
  
  

<meta name="author" content="Do Hyun Kim" />


<meta name="date" content="2023-01-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="13-phenotype-outcome-combine.html"/>
<link rel="next" href="15-tte-dr.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#generating-time-to-event-data-using-uk-biobank-data" id="toc-generating-time-to-event-data-using-uk-biobank-data">Generating time-to-event data using UK biobank data</a></li>
<li><a href="1-reformat-raw-data.html#reformat-raw-data" id="toc-reformat-raw-data"><span class="toc-section-number">1</span> Clean raw UKB assesment center data</a></li>
<li><a href="2-curate-demog-table.html#curate-demog-table" id="toc-curate-demog-table"><span class="toc-section-number">2</span> Curate demographic table</a></li>
<li><a href="3-curate-master-ukb-events-table.html#curate-master-ukb-events-table" id="toc-curate-master-ukb-events-table"><span class="toc-section-number">3</span> Curate a master UKB event table</a>
<ul>
<li><a href="3.1-first-occurrence-event-table-and-algorithmically-defined-outcome-table.html#first-occurrence-event-table-and-algorithmically-defined-outcome-table" id="toc-first-occurrence-event-table-and-algorithmically-defined-outcome-table"><span class="toc-section-number">3.1</span> First occurrence event table and algorithmically defined outcome table</a></li>
<li><a href="3.2-custom-defined-outcome-for-dr.html#custom-defined-outcome-for-dr" id="toc-custom-defined-outcome-for-dr"><span class="toc-section-number">3.2</span> Custom defined outcome for DR</a></li>
<li><a href="3.3-icd-9-10.html#icd-9-10" id="toc-icd-9-10"><span class="toc-section-number">3.3</span> ICD 9 &amp; 10</a></li>
<li><a href="3.4-opcs4.html#opcs4" id="toc-opcs4"><span class="toc-section-number">3.4</span> OPCS4</a></li>
<li><a href="3.5-self-reported-conditions.html#self-reported-conditions" id="toc-self-reported-conditions"><span class="toc-section-number">3.5</span> Self-reported conditions</a></li>
<li><a href="3.6-self-reported-operations.html#self-reported-operations" id="toc-self-reported-operations"><span class="toc-section-number">3.6</span> Self-reported operations</a></li>
<li><a href="3.7-standardize-and-merge-event-tables.html#standardize-and-merge-event-tables" id="toc-standardize-and-merge-event-tables"><span class="toc-section-number">3.7</span> Standardize and merge event tables</a></li>
<li><a href="3.8-convert-ukb-special-dates-into-normal-dates.html#convert-ukb-special-dates-into-normal-dates" id="toc-convert-ukb-special-dates-into-normal-dates"><span class="toc-section-number">3.8</span> Convert UKB special dates into “normal” dates</a></li>
</ul></li>
<li><a href="4-exclude-sex-mismatch-subjects.html#exclude-sex-mismatch-subjects" id="toc-exclude-sex-mismatch-subjects"><span class="toc-section-number">4</span> Filter out subjects with sex mismatch</a></li>
<li><a href="5-prep-pcp-data.html#prep-pcp-data" id="toc-prep-pcp-data"><span class="toc-section-number">5</span> Prepare UKB Primary Care Data</a></li>
<li><a href="6-make-code-dictionary.html#make-code-dictionary" id="toc-make-code-dictionary"><span class="toc-section-number">6</span> Create a master code dictionary for primary care data</a></li>
<li><a href="7-make-outcome-specific-code-dictionary.html#make-outcome-specific-code-dictionary" id="toc-make-outcome-specific-code-dictionary"><span class="toc-section-number">7</span> Make outcome-specific code dictionary</a>
<ul>
<li><a href="7.1-prepare-diabetes-code-dictionary.html#prepare-diabetes-code-dictionary" id="toc-prepare-diabetes-code-dictionary"><span class="toc-section-number">7.1</span> Prepare diabetes code dictionary</a>
<ul>
<li><a href="7.1-prepare-diabetes-code-dictionary.html#define-keywords" id="toc-define-keywords"><span class="toc-section-number">7.1.1</span> Define keywords</a></li>
<li><a href="7.1-prepare-diabetes-code-dictionary.html#define-codes" id="toc-define-codes"><span class="toc-section-number">7.1.2</span> Define codes</a></li>
<li><a href="7.1-prepare-diabetes-code-dictionary.html#create-diabetes-code-dictionary" id="toc-create-diabetes-code-dictionary"><span class="toc-section-number">7.1.3</span> Create diabetes code dictionary</a></li>
</ul></li>
<li><a href="7.2-prepare-diabetic-eye-disease-code-dictionary.html#prepare-diabetic-eye-disease-code-dictionary" id="toc-prepare-diabetic-eye-disease-code-dictionary"><span class="toc-section-number">7.2</span> Prepare diabetic eye disease code dictionary</a>
<ul>
<li><a href="7.2-prepare-diabetic-eye-disease-code-dictionary.html#define-keywords-1" id="toc-define-keywords-1"><span class="toc-section-number">7.2.1</span> Define keywords</a></li>
<li><a href="7.2-prepare-diabetic-eye-disease-code-dictionary.html#define-codes-1" id="toc-define-codes-1"><span class="toc-section-number">7.2.2</span> Define codes</a></li>
<li><a href="7.2-prepare-diabetic-eye-disease-code-dictionary.html#create-diabetic-eye-disease-code-dictionary" id="toc-create-diabetic-eye-disease-code-dictionary"><span class="toc-section-number">7.2.3</span> Create diabetic eye disease code dictionary</a></li>
</ul></li>
<li><a href="7.3-prepare-diabetic-kidney-disease-code-dictionary.html#prepare-diabetic-kidney-disease-code-dictionary" id="toc-prepare-diabetic-kidney-disease-code-dictionary"><span class="toc-section-number">7.3</span> Prepare diabetic kidney disease code dictionary</a>
<ul>
<li><a href="7.3-prepare-diabetic-kidney-disease-code-dictionary.html#define-keywords-2" id="toc-define-keywords-2"><span class="toc-section-number">7.3.1</span> Define Keywords</a></li>
<li><a href="7.3-prepare-diabetic-kidney-disease-code-dictionary.html#define-codes-2" id="toc-define-codes-2"><span class="toc-section-number">7.3.2</span> Define codes</a></li>
<li><a href="7.3-prepare-diabetic-kidney-disease-code-dictionary.html#create-diabetic-kidney-disease-code-dictionary" id="toc-create-diabetic-kidney-disease-code-dictionary"><span class="toc-section-number">7.3.3</span> Create diabetic kidney disease code dictionary</a></li>
</ul></li>
</ul></li>
<li><a href="8-phenotype-outcomes-ukb.html#phenotype-outcomes-ukb" id="toc-phenotype-outcomes-ukb"><span class="toc-section-number">8</span> Phenotype outcome and control exclusion events using UKB assessment center data</a>
<ul>
<li><a href="8.1-phenotype-outcomes.html#phenotype-outcomes" id="toc-phenotype-outcomes"><span class="toc-section-number">8.1</span> Phenotype outcomes</a>
<ul>
<li><a href="8.1-phenotype-outcomes.html#dm" id="toc-dm"><span class="toc-section-number">8.1.1</span> DM</a></li>
<li><a href="8.1-phenotype-outcomes.html#mi" id="toc-mi"><span class="toc-section-number">8.1.2</span> MI</a></li>
<li><a href="8.1-phenotype-outcomes.html#unstable-angina" id="toc-unstable-angina"><span class="toc-section-number">8.1.3</span> Unstable Angina</a></li>
<li><a href="8.1-phenotype-outcomes.html#ischemic-stroke" id="toc-ischemic-stroke"><span class="toc-section-number">8.1.4</span> Ischemic Stroke</a></li>
<li><a href="8.1-phenotype-outcomes.html#hemorrhagic-stroke" id="toc-hemorrhagic-stroke"><span class="toc-section-number">8.1.5</span> Hemorrhagic Stroke</a></li>
<li><a href="8.1-phenotype-outcomes.html#stroke" id="toc-stroke"><span class="toc-section-number">8.1.6</span> Stroke</a></li>
<li><a href="8.1-phenotype-outcomes.html#pci" id="toc-pci"><span class="toc-section-number">8.1.7</span> PCI</a></li>
<li><a href="8.1-phenotype-outcomes.html#cvd-death" id="toc-cvd-death"><span class="toc-section-number">8.1.8</span> CVD death</a></li>
<li><a href="8.1-phenotype-outcomes.html#composite-cvd" id="toc-composite-cvd"><span class="toc-section-number">8.1.9</span> Composite CVD</a></li>
<li><a href="8.1-phenotype-outcomes.html#dr" id="toc-dr"><span class="toc-section-number">8.1.10</span> DR</a></li>
<li><a href="8.1-phenotype-outcomes.html#dkd" id="toc-dkd"><span class="toc-section-number">8.1.11</span> DKD</a></li>
</ul></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#phenotype-control-exclusion-events" id="toc-phenotype-control-exclusion-events"><span class="toc-section-number">8.2</span> Phenotype control exclusion events</a>
<ul>
<li><a href="8.2-phenotype-control-exclusion-events.html#cardiovascular-control-exclusion-events" id="toc-cardiovascular-control-exclusion-events"><span class="toc-section-number">8.2.1</span> Cardiovascular control exclusion events</a></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#cerebrovascular-control-exclusion-events" id="toc-cerebrovascular-control-exclusion-events"><span class="toc-section-number">8.2.2</span> Cerebrovascular control exclusion events</a></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#non-coronary-revascularization-procedure-control-exclusion-events" id="toc-non-coronary-revascularization-procedure-control-exclusion-events"><span class="toc-section-number">8.2.3</span> Non-coronary revascularization procedure control exclusion events</a></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#renal-disease-control-exclusion-events" id="toc-renal-disease-control-exclusion-events"><span class="toc-section-number">8.2.4</span> Renal disease control exclusion events</a></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#eye-disease-control-exclusion-events" id="toc-eye-disease-control-exclusion-events"><span class="toc-section-number">8.2.5</span> Eye disease control exclusion events</a></li>
</ul></li>
</ul></li>
<li><a href="9-phenotype-outcomes-pcp.html#phenotype-outcomes-pcp" id="toc-phenotype-outcomes-pcp"><span class="toc-section-number">9</span> Phenotype outcomes using primary care data</a>
<ul>
<li><a href="9.1-phenotype-outcome-events.html#phenotype-outcome-events" id="toc-phenotype-outcome-events"><span class="toc-section-number">9.1</span> Phenotype outcome events</a>
<ul>
<li><a href="9.1-phenotype-outcome-events.html#dm-1" id="toc-dm-1"><span class="toc-section-number">9.1.1</span> DM</a></li>
<li><a href="9.1-phenotype-outcome-events.html#dr-1" id="toc-dr-1"><span class="toc-section-number">9.1.2</span> DR</a></li>
<li><a href="9.1-phenotype-outcome-events.html#dkd-1" id="toc-dkd-1"><span class="toc-section-number">9.1.3</span> DKD</a></li>
</ul></li>
<li><a href="9.2-phenotype-control-exclusion-events-1.html#phenotype-control-exclusion-events-1" id="toc-phenotype-control-exclusion-events-1"><span class="toc-section-number">9.2</span> Phenotype control exclusion events</a>
<ul>
<li><a href="9.2-phenotype-control-exclusion-events-1.html#non-diabetic-eye-disease-events" id="toc-non-diabetic-eye-disease-events"><span class="toc-section-number">9.2.1</span> Non-diabetic eye disease events</a></li>
<li><a href="9.2-phenotype-control-exclusion-events-1.html#kidney-disease-control-exclusion-events" id="toc-kidney-disease-control-exclusion-events"><span class="toc-section-number">9.2.2</span> Kidney disease control exclusion events</a></li>
</ul></li>
</ul></li>
<li><a href="10-traj-ukb.html#traj-ukb" id="toc-traj-ukb"><span class="toc-section-number">10</span> Create biomarker trajectory data from UK biobank assessment center data</a></li>
<li><a href="11-traj-pcp.html#traj-pcp" id="toc-traj-pcp"><span class="toc-section-number">11</span> Create biomarker trajectory data from primary care data</a>
<ul>
<li><a href="11.1-total-cholesterol.html#total-cholesterol" id="toc-total-cholesterol"><span class="toc-section-number">11.1</span> Total cholesterol</a></li>
<li><a href="11.2-hdl.html#hdl" id="toc-hdl"><span class="toc-section-number">11.2</span> HDL</a></li>
<li><a href="11.3-ldl.html#ldl" id="toc-ldl"><span class="toc-section-number">11.3</span> LDL</a></li>
<li><a href="11.4-triglycerides.html#triglycerides" id="toc-triglycerides"><span class="toc-section-number">11.4</span> Triglycerides</a></li>
<li><a href="11.5-fasting-glucose.html#fasting-glucose" id="toc-fasting-glucose"><span class="toc-section-number">11.5</span> Fasting Glucose</a></li>
<li><a href="11.6-random-glucose.html#random-glucose" id="toc-random-glucose"><span class="toc-section-number">11.6</span> Random glucose</a></li>
<li><a href="11.7-urine-albumin.html#urine-albumin" id="toc-urine-albumin"><span class="toc-section-number">11.7</span> Urine Albumin</a></li>
<li><a href="11.8-urine-creatinine.html#urine-creatinine" id="toc-urine-creatinine"><span class="toc-section-number">11.8</span> Urine creatinine</a></li>
<li><a href="11.9-urine-acr-albumincreatinine-ratio.html#urine-acr-albumincreatinine-ratio" id="toc-urine-acr-albumincreatinine-ratio"><span class="toc-section-number">11.9</span> Urine ACR (Albumin:Creatinine Ratio)</a></li>
<li><a href="11.10-bloodserum-creatinine.html#bloodserum-creatinine" id="toc-bloodserum-creatinine"><span class="toc-section-number">11.10</span> Blood/Serum creatinine</a></li>
<li><a href="11.11-hba1c.html#hba1c" id="toc-hba1c"><span class="toc-section-number">11.11</span> HbA1c</a></li>
<li><a href="11.12-bmi.html#bmi" id="toc-bmi"><span class="toc-section-number">11.12</span> BMI</a></li>
<li><a href="11.13-blood-pressure.html#blood-pressure" id="toc-blood-pressure"><span class="toc-section-number">11.13</span> Blood Pressure</a></li>
<li><a href="11.14-reformat-and-trim-trajectory-table-for-each-biomarker.html#reformat-and-trim-trajectory-table-for-each-biomarker" id="toc-reformat-and-trim-trajectory-table-for-each-biomarker"><span class="toc-section-number">11.14</span> Reformat and trim trajectory table for each biomarker</a></li>
</ul></li>
<li><a href="12-traj-combine.html#traj-combine" id="toc-traj-combine"><span class="toc-section-number">12</span> Combine biomarker trajectory extracted from from UKB and PCP data</a></li>
<li><a href="13-phenotype-outcome-combine.html#phenotype-outcome-combine" id="toc-phenotype-outcome-combine"><span class="toc-section-number">13</span> Phenotype outcomes using combination of tables</a></li>
<li><a href="14-tte-macro.html#tte-macro" id="toc-tte-macro"><span class="toc-section-number">14</span> Generate time-to-event data for macrovascular diabetes complications</a></li>
<li><a href="15-tte-dr.html#tte-dr" id="toc-tte-dr"><span class="toc-section-number">15</span> Generate time-to-event data for diabetic eye disease</a></li>
<li><a href="16-tte-dkd.html#tte-dkd" id="toc-tte-dkd"><span class="toc-section-number">16</span> Generate time-to-event data for diabetes related kidney disease</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">UK Biobank Phenotyping</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tte-macro" class="section level1" number="14">
<h1><span class="header-section-number">14</span> Generate time-to-event data for macrovascular diabetes complications</h1>
<p>In this chapter, we phenotype right-censored time-to-event data for the following macrovascular diabetes compliations:</p>
<ul>
<li>Myocardial Infarction (MI)</li>
<li>Unstable Angina (UA)</li>
<li>Ischemic Stroke (IS)</li>
<li>Hemorrhagic Stroke (HS)</li>
<li>Stroke (ST)</li>
<li>PCI</li>
<li>Composite CVD</li>
</ul>
<p>To compute time-to-event, we require an index date (time-zero point) and event date of an outcome. In our case, we can define index date to be the first diagnosis date of diabetes or UKB study initiation date. For right-censored data, we define the index date as UKB study initiation date. In later chapters, we create interval-censored data by setting the index date as the first diabetes diagnosis date.</p>
<p>We now introduce a phenotyping procedure for right-censored data. For each complication outcome, we create an initial time-to-event data by combining the first occurrence diabetes event table, the first occurrence outcome event table and demographic table. As we merge these data to produce the initial time-to-event data, the cases and controls occur. The case is defined as a subject who has a complication event before the censoring date (defined in chapter <a href="2-curate-demog-table.html#curate-demog-table">2</a>). Otherwise, a subject is defined as control.</p>
<p>Next, we refine the initial time-to-event data by applying the following exclusion criteria for cases and controls:</p>
<ul>
<li>case
<ul>
<li>has a complication event after the censoring date</li>
<li>has a prior complication event identified before a first evidence of diabetes</li>
<li>has an initiation date that is not between the first evidence of diabetes and the date of complication event</li>
</ul></li>
<li>control
<ul>
<li>has some event represented in a control exclusion event table(s) (all generated in chapter <a href="8-phenotype-outcomes-ukb.html#phenotype-outcomes-ukb">8</a>; also see the table below)</li>
<li>has a first evidence of diabetes after the censoring date</li>
<li>has less than 5 years of follow-up time since the first evidence of diabetes before censoring date</li>
<li>has a first evidence of diabets 6 months after the study initiation date</li>
</ul></li>
</ul>
<p>The following table shows macrovascular complications and associated control exclusion event table(s):</p>
<table>
<colgroup>
<col width="76%" />
<col width="23%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Macrovascular complication</th>
<th align="left">Control exclusion outcome</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Myocardial Infarction</td>
<td align="left">cardiovascular control exclusion events</td>
</tr>
<tr class="even">
<td align="left">Unstable Angina</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Ischemic Stroke</td>
<td align="left">cerebrovascular control exclusion events</td>
</tr>
<tr class="even">
<td align="left">Hemorrhagic Stroke</td>
<td align="left">cerebrovascular control exclusion events</td>
</tr>
<tr class="odd">
<td align="left">Stroke</td>
<td align="left">cerebrovascular control exclusion events</td>
</tr>
<tr class="even">
<td align="left">PCI</td>
<td align="left">non-coronary revascularization procedure control exclusion events</td>
</tr>
<tr class="odd">
<td align="left">Composite CVD</td>
<td align="left">control exclusion events associated with MI, Ischemic stroke, unstable angina and PCI</td>
</tr>
</tbody>
</table>
<p>The event tables for all of the above control exclusion events were created in chapter <a href="8-phenotype-outcomes-ukb.html#phenotype-outcomes-ukb">8</a>. The phenotyping procedure for time-to-event data is encapsulated in a function <code>phenotype_time_to_event()</code> defined in <code>functions.R</code>.</p>
<p>Load packages and functions.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="14-tte-macro.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb262-2"><a href="14-tte-macro.html#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb262-3"><a href="14-tte-macro.html#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;functions.R&quot;</span>)</span></code></pre></div>
<p>Load first occurrence DM data.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="14-tte-macro.html#cb263-1" aria-hidden="true" tabindex="-1"></a>dm_firstoccur <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/dm_firstoccur.RDS&quot;</span>)</span></code></pre></div>
<p>Load demographic data.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="14-tte-macro.html#cb264-1" aria-hidden="true" tabindex="-1"></a>demog <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/demog_selected.RDS&quot;</span>)</span></code></pre></div>
<p><strong>MI</strong></p>
<p>Load MI first occurrence data phenotyped from UKB assessment data.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="14-tte-macro.html#cb265-1" aria-hidden="true" tabindex="-1"></a>mi_firstoccur_ukb <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/mi_firstoccur_ukb.RDS&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(f.eid,event_dt)</span></code></pre></div>
<p>Load cardiovascular event table that will be used to exclude controls.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="14-tte-macro.html#cb266-1" aria-hidden="true" tabindex="-1"></a>cardio <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/cardio_control_exclusion_events_ukb.RDS&quot;</span>)</span></code></pre></div>
<p>Define control exclusion subject IDs.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="14-tte-macro.html#cb267-1" aria-hidden="true" tabindex="-1"></a>ctrl_exclusion_ids_cardio <span class="ot">&lt;-</span> cardio<span class="sc">$</span>f.eid <span class="sc">%&gt;%</span> unique</span></code></pre></div>
<p>Phenotype time-to-event.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="14-tte-macro.html#cb268-1" aria-hidden="true" tabindex="-1"></a>mi_tte <span class="ot">&lt;-</span> <span class="fu">phenotype_time_to_event</span>(dm_firstoccur, mi_firstoccur_ukb,</span>
<span id="cb268-2"><a href="14-tte-macro.html#cb268-2" aria-hidden="true" tabindex="-1"></a>                        demog, <span class="at">control_exclusion_ids =</span> ctrl_exclusion_ids_cardio)</span></code></pre></div>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="14-tte-macro.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(mi_tte,<span class="st">&quot;generated_data/mi_tte.RDS&quot;</span>)</span></code></pre></div>
<p><strong>Unstable angina</strong></p>
<p>Load unstable angina first occurrence data phenotyped from UKB assessment data.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="14-tte-macro.html#cb270-1" aria-hidden="true" tabindex="-1"></a>unstable_angina_firstoccur_ukb <span class="ot">&lt;-</span> </span>
<span id="cb270-2"><a href="14-tte-macro.html#cb270-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/unstable_angina_firstoccur_ukb.RDS&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(f.eid,event_dt)</span></code></pre></div>
<p>Phenotype time-to-event.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="14-tte-macro.html#cb271-1" aria-hidden="true" tabindex="-1"></a>unstable_angina_tte <span class="ot">&lt;-</span> <span class="fu">phenotype_time_to_event</span>(dm_firstoccur,unstable_angina_firstoccur_ukb,demog)</span></code></pre></div>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="14-tte-macro.html#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(unstable_angina_tte,<span class="st">&quot;generated_data/unstable_angina_tte.RDS&quot;</span>)</span></code></pre></div>
<p><strong>Ischemic stroke</strong></p>
<p>Load ischemic stroke first occurrence data phenotyped from UKB assessment data.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="14-tte-macro.html#cb273-1" aria-hidden="true" tabindex="-1"></a>ischemic_stroke_firstoccur_ukb <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/stroke_infarct_firstoccur_ukb.RDS&quot;</span>)</span></code></pre></div>
<p>Load cerebrovascular event table that will be used to exclude controls.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="14-tte-macro.html#cb274-1" aria-hidden="true" tabindex="-1"></a>cerebro <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/cerebro_control_exclusion_events_ukb.RDS&quot;</span>)</span></code></pre></div>
<p>Define control exclusion subject IDs.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="14-tte-macro.html#cb275-1" aria-hidden="true" tabindex="-1"></a>ctrl_exclusion_ids_cerebro <span class="ot">&lt;-</span> cerebro<span class="sc">$</span>f.eid <span class="sc">%&gt;%</span> unique</span></code></pre></div>
<p>Phenotype time-to-event.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="14-tte-macro.html#cb276-1" aria-hidden="true" tabindex="-1"></a>ischemic_stroke_tte <span class="ot">&lt;-</span> <span class="fu">phenotype_time_to_event</span>(dm_firstoccur,ischemic_stroke_firstoccur_ukb,demog,</span>
<span id="cb276-2"><a href="14-tte-macro.html#cb276-2" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">control_exclusion_ids =</span> ctrl_exclusion_ids_cerebro)</span></code></pre></div>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="14-tte-macro.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(ischemic_stroke_tte,<span class="st">&quot;generated_data/ischemic_stroke_tte.RDS&quot;</span>)</span></code></pre></div>
<p><strong>Hemorrhagic Stroke</strong></p>
<p>Load hemorrhagic stroke first occurrence data phenotyped from UKB assessment data.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="14-tte-macro.html#cb278-1" aria-hidden="true" tabindex="-1"></a>hem_stroke_firstoccur_ukb <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/stroke_hem_firstoccur_ukb.RDS&quot;</span>)</span></code></pre></div>
<p>Load cerebrovascular event table that will be used to exclude controls.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="14-tte-macro.html#cb279-1" aria-hidden="true" tabindex="-1"></a>cerebro <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/cerebro_control_exclusion_events_ukb.RDS&quot;</span>)</span></code></pre></div>
<p>Define control exclusion subject IDs.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="14-tte-macro.html#cb280-1" aria-hidden="true" tabindex="-1"></a>ctrl_exclusion_ids_cerebro <span class="ot">&lt;-</span> cerebro<span class="sc">$</span>f.eid <span class="sc">%&gt;%</span> unique</span></code></pre></div>
<p>Phenotype time-to-event.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="14-tte-macro.html#cb281-1" aria-hidden="true" tabindex="-1"></a>hem_stroke_tte <span class="ot">&lt;-</span> <span class="fu">phenotype_time_to_event</span>(dm_firstoccur,hem_stroke_firstoccur_ukb,demog,</span>
<span id="cb281-2"><a href="14-tte-macro.html#cb281-2" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">control_exclusion_ids =</span> ctrl_exclusion_ids_cerebro)</span></code></pre></div>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="14-tte-macro.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(hem_stroke_tte,<span class="st">&quot;generated_data/hem_stroke_tte.RDS&quot;</span>)</span></code></pre></div>
<p><strong>Stroke</strong></p>
<p>Load stroke first occurrence data phenotyped from UKB assessment data.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="14-tte-macro.html#cb283-1" aria-hidden="true" tabindex="-1"></a>stroke_firstoccur_ukb <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/stroke_firstoccur_ukb.RDS&quot;</span>)</span></code></pre></div>
<p>Load cerebrovascular event table that will be used to exclude controls.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="14-tte-macro.html#cb284-1" aria-hidden="true" tabindex="-1"></a>cerebro <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/cerebro_control_exclusion_events_ukb.RDS&quot;</span>)</span></code></pre></div>
<p>Define control exclusion subject IDs.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="14-tte-macro.html#cb285-1" aria-hidden="true" tabindex="-1"></a>ctrl_exclusion_ids_cerebro <span class="ot">&lt;-</span> cerebro<span class="sc">$</span>f.eid <span class="sc">%&gt;%</span> unique</span></code></pre></div>
<p>Phenotype time-to-event.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="14-tte-macro.html#cb286-1" aria-hidden="true" tabindex="-1"></a>stroke_tte <span class="ot">&lt;-</span> <span class="fu">phenotype_time_to_event</span>(dm_firstoccur,stroke_firstoccur_ukb,demog,</span>
<span id="cb286-2"><a href="14-tte-macro.html#cb286-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">control_exclusion_ids =</span> ctrl_exclusion_ids_cerebro)</span></code></pre></div>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="14-tte-macro.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(stroke_tte,<span class="st">&quot;generated_data/stroke_tte.RDS&quot;</span>)</span></code></pre></div>
<p><strong>PCI</strong></p>
<p>Load PCI first occurrence data phenotyped from UKB assessment data.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="14-tte-macro.html#cb288-1" aria-hidden="true" tabindex="-1"></a>pci_firstoccur_ukb <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/pci_firstoccur_ukb.RDS&quot;</span>)</span></code></pre></div>
<p>Load non-coronary revascularization event table that will be used to exclude controls.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="14-tte-macro.html#cb289-1" aria-hidden="true" tabindex="-1"></a>other_revas <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/other_revas_control_exclusion_events_ukb.RDS&quot;</span>)</span></code></pre></div>
<p>Define control exclusion subject IDs.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="14-tte-macro.html#cb290-1" aria-hidden="true" tabindex="-1"></a>ctrl_exclusion_ids_other_revas <span class="ot">&lt;-</span> other_revas<span class="sc">$</span>f.eid <span class="sc">%&gt;%</span> unique</span></code></pre></div>
<p>Phenotype time-to-event.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="14-tte-macro.html#cb291-1" aria-hidden="true" tabindex="-1"></a>pci_tte <span class="ot">&lt;-</span> <span class="fu">phenotype_time_to_event</span>(dm_firstoccur,pci_firstoccur_ukb,demog,</span>
<span id="cb291-2"><a href="14-tte-macro.html#cb291-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">control_exclusion_ids =</span> ctrl_exclusion_ids_other_revas)</span></code></pre></div>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="14-tte-macro.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(pci_tte,<span class="st">&quot;generated_data/pci_tte.RDS&quot;</span>)</span></code></pre></div>
<p><strong>Composite CVD (MI, Unstable Angina, Ischemic Stroke, PCI or CVD death)</strong></p>
<p>Load composite CVD first occurrence data phenotyped from UKB assessment data.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="14-tte-macro.html#cb293-1" aria-hidden="true" tabindex="-1"></a>cvd_firstoccur_ukb <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/cvd_firstoccur_ukb.RDS&quot;</span>)</span></code></pre></div>
<p>Create control exclusion table for CVD. They are combination of cardio, cerebro and other revasculrization events that were used to exclude controls when phenotyping MI, unstable angina, ischemic sstroke and PCI time-to-event data.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="14-tte-macro.html#cb294-1" aria-hidden="true" tabindex="-1"></a>composite_cvd_control_exclusion_events <span class="ot">&lt;-</span> <span class="fu">list</span>(cardio,cerebro,other_revas) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>()</span></code></pre></div>
<p>Define control exclusion subject IDs.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="14-tte-macro.html#cb295-1" aria-hidden="true" tabindex="-1"></a>ctrl_exclusion_ids_cvd <span class="ot">&lt;-</span> composite_cvd_control_exclusion_events<span class="sc">$</span>f.eid <span class="sc">%&gt;%</span> unique</span></code></pre></div>
<p>Phenotype time-to-event.</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="14-tte-macro.html#cb296-1" aria-hidden="true" tabindex="-1"></a>cvd_tte <span class="ot">&lt;-</span> <span class="fu">phenotype_time_to_event</span>(dm_firstoccur,cvd_firstoccur_ukb,demog,</span>
<span id="cb296-2"><a href="14-tte-macro.html#cb296-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">control_exclusion_ids =</span> ctrl_exclusion_ids_cvd)</span></code></pre></div>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="14-tte-macro.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(cvd_tte,<span class="st">&quot;generated_data/cvd_tte.RDS&quot;</span>)</span></code></pre></div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="13-phenotype-outcome-combine.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="15-tte-dr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
