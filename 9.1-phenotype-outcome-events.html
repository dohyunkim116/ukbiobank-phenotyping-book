<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9.1 Phenotype outcome events | UK Biobank Phenotyping</title>
  <meta name="description" content="9.1 Phenotype outcome events | UK Biobank Phenotyping" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="9.1 Phenotype outcome events | UK Biobank Phenotyping" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9.1 Phenotype outcome events | UK Biobank Phenotyping" />
  
  
  

<meta name="author" content="Do Hyun Kim" />


<meta name="date" content="2023-01-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="9-phenotype-outcomes-pcp.html"/>
<link rel="next" href="9.2-phenotype-control-exclusion-events-1.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#generating-time-to-event-data-using-uk-biobank-data" id="toc-generating-time-to-event-data-using-uk-biobank-data">Generating time-to-event data using UK biobank data</a></li>
<li><a href="1-reformat-raw-data.html#reformat-raw-data" id="toc-reformat-raw-data"><span class="toc-section-number">1</span> Clean raw UKB assesment center data</a></li>
<li><a href="2-curate-demog-table.html#curate-demog-table" id="toc-curate-demog-table"><span class="toc-section-number">2</span> Curate demographic table</a></li>
<li><a href="3-curate-master-ukb-events-table.html#curate-master-ukb-events-table" id="toc-curate-master-ukb-events-table"><span class="toc-section-number">3</span> Curate a master UKB event table</a>
<ul>
<li><a href="3.1-first-occurrence-event-table-and-algorithmically-defined-outcome-table.html#first-occurrence-event-table-and-algorithmically-defined-outcome-table" id="toc-first-occurrence-event-table-and-algorithmically-defined-outcome-table"><span class="toc-section-number">3.1</span> First occurrence event table and algorithmically defined outcome table</a></li>
<li><a href="3.2-custom-defined-outcome-for-dr.html#custom-defined-outcome-for-dr" id="toc-custom-defined-outcome-for-dr"><span class="toc-section-number">3.2</span> Custom defined outcome for DR</a></li>
<li><a href="3.3-icd-9-10.html#icd-9-10" id="toc-icd-9-10"><span class="toc-section-number">3.3</span> ICD 9 &amp; 10</a></li>
<li><a href="3.4-opcs4.html#opcs4" id="toc-opcs4"><span class="toc-section-number">3.4</span> OPCS4</a></li>
<li><a href="3.5-self-reported-conditions.html#self-reported-conditions" id="toc-self-reported-conditions"><span class="toc-section-number">3.5</span> Self-reported conditions</a></li>
<li><a href="3.6-self-reported-operations.html#self-reported-operations" id="toc-self-reported-operations"><span class="toc-section-number">3.6</span> Self-reported operations</a></li>
<li><a href="3.7-standardize-and-merge-event-tables.html#standardize-and-merge-event-tables" id="toc-standardize-and-merge-event-tables"><span class="toc-section-number">3.7</span> Standardize and merge event tables</a></li>
<li><a href="3.8-convert-ukb-special-dates-into-normal-dates.html#convert-ukb-special-dates-into-normal-dates" id="toc-convert-ukb-special-dates-into-normal-dates"><span class="toc-section-number">3.8</span> Convert UKB special dates into “normal” dates</a></li>
</ul></li>
<li><a href="4-exclude-sex-mismatch-subjects.html#exclude-sex-mismatch-subjects" id="toc-exclude-sex-mismatch-subjects"><span class="toc-section-number">4</span> Filter out subjects with sex mismatch</a></li>
<li><a href="5-prep-pcp-data.html#prep-pcp-data" id="toc-prep-pcp-data"><span class="toc-section-number">5</span> Prepare UKB Primary Care Data</a></li>
<li><a href="6-make-code-dictionary.html#make-code-dictionary" id="toc-make-code-dictionary"><span class="toc-section-number">6</span> Create a master code dictionary for primary care data</a></li>
<li><a href="7-make-outcome-specific-code-dictionary.html#make-outcome-specific-code-dictionary" id="toc-make-outcome-specific-code-dictionary"><span class="toc-section-number">7</span> Make outcome-specific code dictionary</a>
<ul>
<li><a href="7.1-prepare-diabetes-code-dictionary.html#prepare-diabetes-code-dictionary" id="toc-prepare-diabetes-code-dictionary"><span class="toc-section-number">7.1</span> Prepare diabetes code dictionary</a>
<ul>
<li><a href="7.1-prepare-diabetes-code-dictionary.html#define-keywords" id="toc-define-keywords"><span class="toc-section-number">7.1.1</span> Define keywords</a></li>
<li><a href="7.1-prepare-diabetes-code-dictionary.html#define-codes" id="toc-define-codes"><span class="toc-section-number">7.1.2</span> Define codes</a></li>
<li><a href="7.1-prepare-diabetes-code-dictionary.html#create-diabetes-code-dictionary" id="toc-create-diabetes-code-dictionary"><span class="toc-section-number">7.1.3</span> Create diabetes code dictionary</a></li>
</ul></li>
<li><a href="7.2-prepare-diabetic-eye-disease-code-dictionary.html#prepare-diabetic-eye-disease-code-dictionary" id="toc-prepare-diabetic-eye-disease-code-dictionary"><span class="toc-section-number">7.2</span> Prepare diabetic eye disease code dictionary</a>
<ul>
<li><a href="7.2-prepare-diabetic-eye-disease-code-dictionary.html#define-keywords-1" id="toc-define-keywords-1"><span class="toc-section-number">7.2.1</span> Define keywords</a></li>
<li><a href="7.2-prepare-diabetic-eye-disease-code-dictionary.html#define-codes-1" id="toc-define-codes-1"><span class="toc-section-number">7.2.2</span> Define codes</a></li>
<li><a href="7.2-prepare-diabetic-eye-disease-code-dictionary.html#create-diabetic-eye-disease-code-dictionary" id="toc-create-diabetic-eye-disease-code-dictionary"><span class="toc-section-number">7.2.3</span> Create diabetic eye disease code dictionary</a></li>
</ul></li>
<li><a href="7.3-prepare-diabetic-kidney-disease-code-dictionary.html#prepare-diabetic-kidney-disease-code-dictionary" id="toc-prepare-diabetic-kidney-disease-code-dictionary"><span class="toc-section-number">7.3</span> Prepare diabetic kidney disease code dictionary</a>
<ul>
<li><a href="7.3-prepare-diabetic-kidney-disease-code-dictionary.html#define-keywords-2" id="toc-define-keywords-2"><span class="toc-section-number">7.3.1</span> Define Keywords</a></li>
<li><a href="7.3-prepare-diabetic-kidney-disease-code-dictionary.html#define-codes-2" id="toc-define-codes-2"><span class="toc-section-number">7.3.2</span> Define codes</a></li>
<li><a href="7.3-prepare-diabetic-kidney-disease-code-dictionary.html#create-diabetic-kidney-disease-code-dictionary" id="toc-create-diabetic-kidney-disease-code-dictionary"><span class="toc-section-number">7.3.3</span> Create diabetic kidney disease code dictionary</a></li>
</ul></li>
</ul></li>
<li><a href="8-phenotype-outcomes-ukb.html#phenotype-outcomes-ukb" id="toc-phenotype-outcomes-ukb"><span class="toc-section-number">8</span> Phenotype outcome and control exclusion events using UKB assessment center data</a>
<ul>
<li><a href="8.1-phenotype-outcomes.html#phenotype-outcomes" id="toc-phenotype-outcomes"><span class="toc-section-number">8.1</span> Phenotype outcomes</a>
<ul>
<li><a href="8.1-phenotype-outcomes.html#dm" id="toc-dm"><span class="toc-section-number">8.1.1</span> DM</a></li>
<li><a href="8.1-phenotype-outcomes.html#mi" id="toc-mi"><span class="toc-section-number">8.1.2</span> MI</a></li>
<li><a href="8.1-phenotype-outcomes.html#unstable-angina" id="toc-unstable-angina"><span class="toc-section-number">8.1.3</span> Unstable Angina</a></li>
<li><a href="8.1-phenotype-outcomes.html#ischemic-stroke" id="toc-ischemic-stroke"><span class="toc-section-number">8.1.4</span> Ischemic Stroke</a></li>
<li><a href="8.1-phenotype-outcomes.html#hemorrhagic-stroke" id="toc-hemorrhagic-stroke"><span class="toc-section-number">8.1.5</span> Hemorrhagic Stroke</a></li>
<li><a href="8.1-phenotype-outcomes.html#stroke" id="toc-stroke"><span class="toc-section-number">8.1.6</span> Stroke</a></li>
<li><a href="8.1-phenotype-outcomes.html#pci" id="toc-pci"><span class="toc-section-number">8.1.7</span> PCI</a></li>
<li><a href="8.1-phenotype-outcomes.html#cvd-death" id="toc-cvd-death"><span class="toc-section-number">8.1.8</span> CVD death</a></li>
<li><a href="8.1-phenotype-outcomes.html#composite-cvd" id="toc-composite-cvd"><span class="toc-section-number">8.1.9</span> Composite CVD</a></li>
<li><a href="8.1-phenotype-outcomes.html#dr" id="toc-dr"><span class="toc-section-number">8.1.10</span> DR</a></li>
<li><a href="8.1-phenotype-outcomes.html#dkd" id="toc-dkd"><span class="toc-section-number">8.1.11</span> DKD</a></li>
</ul></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#phenotype-control-exclusion-events" id="toc-phenotype-control-exclusion-events"><span class="toc-section-number">8.2</span> Phenotype control exclusion events</a>
<ul>
<li><a href="8.2-phenotype-control-exclusion-events.html#cardiovascular-control-exclusion-events" id="toc-cardiovascular-control-exclusion-events"><span class="toc-section-number">8.2.1</span> Cardiovascular control exclusion events</a></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#cerebrovascular-control-exclusion-events" id="toc-cerebrovascular-control-exclusion-events"><span class="toc-section-number">8.2.2</span> Cerebrovascular control exclusion events</a></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#non-coronary-revascularization-procedure-control-exclusion-events" id="toc-non-coronary-revascularization-procedure-control-exclusion-events"><span class="toc-section-number">8.2.3</span> Non-coronary revascularization procedure control exclusion events</a></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#renal-disease-control-exclusion-events" id="toc-renal-disease-control-exclusion-events"><span class="toc-section-number">8.2.4</span> Renal disease control exclusion events</a></li>
<li><a href="8.2-phenotype-control-exclusion-events.html#eye-disease-control-exclusion-events" id="toc-eye-disease-control-exclusion-events"><span class="toc-section-number">8.2.5</span> Eye disease control exclusion events</a></li>
</ul></li>
</ul></li>
<li><a href="9-phenotype-outcomes-pcp.html#phenotype-outcomes-pcp" id="toc-phenotype-outcomes-pcp"><span class="toc-section-number">9</span> Phenotype outcomes using primary care data</a>
<ul>
<li><a href="9.1-phenotype-outcome-events.html#phenotype-outcome-events" id="toc-phenotype-outcome-events"><span class="toc-section-number">9.1</span> Phenotype outcome events</a>
<ul>
<li><a href="9.1-phenotype-outcome-events.html#dm-1" id="toc-dm-1"><span class="toc-section-number">9.1.1</span> DM</a></li>
<li><a href="9.1-phenotype-outcome-events.html#dr-1" id="toc-dr-1"><span class="toc-section-number">9.1.2</span> DR</a></li>
<li><a href="9.1-phenotype-outcome-events.html#dkd-1" id="toc-dkd-1"><span class="toc-section-number">9.1.3</span> DKD</a></li>
</ul></li>
<li><a href="9.2-phenotype-control-exclusion-events-1.html#phenotype-control-exclusion-events-1" id="toc-phenotype-control-exclusion-events-1"><span class="toc-section-number">9.2</span> Phenotype control exclusion events</a>
<ul>
<li><a href="9.2-phenotype-control-exclusion-events-1.html#non-diabetic-eye-disease-events" id="toc-non-diabetic-eye-disease-events"><span class="toc-section-number">9.2.1</span> Non-diabetic eye disease events</a></li>
<li><a href="9.2-phenotype-control-exclusion-events-1.html#kidney-disease-control-exclusion-events" id="toc-kidney-disease-control-exclusion-events"><span class="toc-section-number">9.2.2</span> Kidney disease control exclusion events</a></li>
</ul></li>
</ul></li>
<li><a href="10-traj-ukb.html#traj-ukb" id="toc-traj-ukb"><span class="toc-section-number">10</span> Create biomarker trajectory data from UK biobank assessment center data</a></li>
<li><a href="11-traj-pcp.html#traj-pcp" id="toc-traj-pcp"><span class="toc-section-number">11</span> Create biomarker trajectory data from primary care data</a>
<ul>
<li><a href="11.1-total-cholesterol.html#total-cholesterol" id="toc-total-cholesterol"><span class="toc-section-number">11.1</span> Total cholesterol</a></li>
<li><a href="11.2-hdl.html#hdl" id="toc-hdl"><span class="toc-section-number">11.2</span> HDL</a></li>
<li><a href="11.3-ldl.html#ldl" id="toc-ldl"><span class="toc-section-number">11.3</span> LDL</a></li>
<li><a href="11.4-triglycerides.html#triglycerides" id="toc-triglycerides"><span class="toc-section-number">11.4</span> Triglycerides</a></li>
<li><a href="11.5-fasting-glucose.html#fasting-glucose" id="toc-fasting-glucose"><span class="toc-section-number">11.5</span> Fasting Glucose</a></li>
<li><a href="11.6-random-glucose.html#random-glucose" id="toc-random-glucose"><span class="toc-section-number">11.6</span> Random glucose</a></li>
<li><a href="11.7-urine-albumin.html#urine-albumin" id="toc-urine-albumin"><span class="toc-section-number">11.7</span> Urine Albumin</a></li>
<li><a href="11.8-urine-creatinine.html#urine-creatinine" id="toc-urine-creatinine"><span class="toc-section-number">11.8</span> Urine creatinine</a></li>
<li><a href="11.9-urine-acr-albumincreatinine-ratio.html#urine-acr-albumincreatinine-ratio" id="toc-urine-acr-albumincreatinine-ratio"><span class="toc-section-number">11.9</span> Urine ACR (Albumin:Creatinine Ratio)</a></li>
<li><a href="11.10-bloodserum-creatinine.html#bloodserum-creatinine" id="toc-bloodserum-creatinine"><span class="toc-section-number">11.10</span> Blood/Serum creatinine</a></li>
<li><a href="11.11-hba1c.html#hba1c" id="toc-hba1c"><span class="toc-section-number">11.11</span> HbA1c</a></li>
<li><a href="11.12-bmi.html#bmi" id="toc-bmi"><span class="toc-section-number">11.12</span> BMI</a></li>
<li><a href="11.13-blood-pressure.html#blood-pressure" id="toc-blood-pressure"><span class="toc-section-number">11.13</span> Blood Pressure</a></li>
<li><a href="11.14-reformat-and-trim-trajectory-table-for-each-biomarker.html#reformat-and-trim-trajectory-table-for-each-biomarker" id="toc-reformat-and-trim-trajectory-table-for-each-biomarker"><span class="toc-section-number">11.14</span> Reformat and trim trajectory table for each biomarker</a></li>
</ul></li>
<li><a href="12-traj-combine.html#traj-combine" id="toc-traj-combine"><span class="toc-section-number">12</span> Combine biomarker trajectory extracted from from UKB and PCP data</a></li>
<li><a href="13-phenotype-outcome-combine.html#phenotype-outcome-combine" id="toc-phenotype-outcome-combine"><span class="toc-section-number">13</span> Phenotype outcomes using combination of tables</a></li>
<li><a href="14-tte-macro.html#tte-macro" id="toc-tte-macro"><span class="toc-section-number">14</span> Generate time-to-event data for macrovascular diabetes complications</a></li>
<li><a href="15-tte-dr.html#tte-dr" id="toc-tte-dr"><span class="toc-section-number">15</span> Generate time-to-event data for diabetic eye disease</a></li>
<li><a href="16-tte-dkd.html#tte-dkd" id="toc-tte-dkd"><span class="toc-section-number">16</span> Generate time-to-event data for diabetes related kidney disease</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">UK Biobank Phenotyping</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="phenotype-outcome-events" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Phenotype outcome events</h2>
<p>Load packages and <code>reference.R</code> which will be used in phenotyping diabetes (details in DM section below).</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="9.1-phenotype-outcome-events.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb170-2"><a href="9.1-phenotype-outcome-events.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb170-3"><a href="9.1-phenotype-outcome-events.html#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;reference.R&quot;</span>)</span></code></pre></div>
<p>Import primary care data.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="9.1-phenotype-outcome-events.html#cb171-1" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;generated_data/entire_gp_clinical_30March2021_formatted.txt&quot;</span>)</span></code></pre></div>
<p>Import outcome-specific dictionaries.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="9.1-phenotype-outcome-events.html#cb172-1" aria-hidden="true" tabindex="-1"></a>dm_dict <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/dm_dict.RDS&quot;</span>)</span>
<span id="cb172-2"><a href="9.1-phenotype-outcome-events.html#cb172-2" aria-hidden="true" tabindex="-1"></a>dr_dict <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/dm_eye_disease_dict.RDS&quot;</span>)</span>
<span id="cb172-3"><a href="9.1-phenotype-outcome-events.html#cb172-3" aria-hidden="true" tabindex="-1"></a>kidney_disease_case_dict <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;generated_data/kidney_disease_case_dict.RDS&quot;</span>)</span></code></pre></div>
<div id="dm-1" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> DM</h3>
<p>Define T1D and T2D keywords.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="9.1-phenotype-outcome-events.html#cb173-1" aria-hidden="true" tabindex="-1"></a>type2_kw <span class="ot">&lt;-</span> <span class="st">&quot;type 2|type II|adult onset|non[ -]insulin[ -]dep|NIDD|maturity onset diabetes mellitus$&quot;</span></span>
<span id="cb173-2"><a href="9.1-phenotype-outcome-events.html#cb173-2" aria-hidden="true" tabindex="-1"></a>type1_kw <span class="ot">&lt;-</span> <span class="st">&quot;type 1|type I[ $-]|juvenile|insulin-dependant|insulin dependent&quot;</span></span></code></pre></div>
<p>Add diabetes types to DM dictionary.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="9.1-phenotype-outcome-events.html#cb174-1" aria-hidden="true" tabindex="-1"></a>dm_dict <span class="ot">&lt;-</span> dm_dict <span class="sc">%&gt;%</span></span>
<span id="cb174-2"><a href="9.1-phenotype-outcome-events.html#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dm_type =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(type2_kw,term_description, <span class="at">ignore.case=</span>T), <span class="st">&quot;Type2&quot;</span>, <span class="fu">ifelse</span>(<span class="fu">grepl</span>(type1_kw, term_description, <span class="at">ignore.case=</span>T), <span class="st">&quot;Type1&quot;</span>, <span class="st">&quot;Uncertain&quot;</span>)))</span></code></pre></div>
<p>Subset the primary care data to subjects with diabetes and identify which type of diabetes each event is associated with</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="9.1-phenotype-outcome-events.html#cb175-1" aria-hidden="true" tabindex="-1"></a>diabetics_any <span class="ot">&lt;-</span> pc <span class="sc">%&gt;%</span></span>
<span id="cb175-2"><a href="9.1-phenotype-outcome-events.html#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(f.eid, code, event_dt) <span class="sc">%&gt;%</span></span>
<span id="cb175-3"><a href="9.1-phenotype-outcome-events.html#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(code <span class="sc">%in%</span> <span class="fu">unique</span>(dm_dict<span class="sc">$</span>code)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb175-4"><a href="9.1-phenotype-outcome-events.html#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dm_dict <span class="sc">%&gt;%</span> <span class="fu">select</span>(code,dm_type), <span class="at">by =</span> <span class="st">&quot;code&quot;</span>)</span></code></pre></div>
<p>Next, we select the terms in the DM-specific dictionary whose descriptions reflect more clear indications of DM. Defined as an object <code>dm_descriptions</code> in <code>reference.R</code>, the descriptions were selected with the help of an expert.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="9.1-phenotype-outcome-events.html#cb176-1" aria-hidden="true" tabindex="-1"></a>dm_codes_confident <span class="ot">&lt;-</span>  dm_dict <span class="sc">%&gt;%</span> <span class="fu">filter</span>(term_description <span class="sc">%in%</span> dm_descriptions) <span class="sc">%&gt;%</span> .<span class="sc">$</span>code <span class="sc">%&gt;%</span> unique</span></code></pre></div>
<p>We define this list of terms with clear DM indications to be able to more accurately identify the first diagnosis date diabetes. Specifically, if a subject had terms predating the certain diagnosis which are less certain, we assume that the earlier diagnosis was the better start date. For example, consider a hypothetical subject with following diabetes events:</p>
<ul>
<li>2012: “Diabetic dietary review”</li>
<li>2013: “Type II diabetes”</li>
</ul>
<p>This individual will be considered type 2 diabetic patient with 2012 as the first date of DM diagnosis. Although the predating description “Diabetic dietary review” is a less certain of diagnosis, a subsequent diagnosis of “Type II diabetes” tells us this subject clearly has Type II diabetes. In contrast, the following subject would not be included as diabetes patient because the codes are not strong enough to indicate diabetes:</p>
<ul>
<li>2012: “Diabetic dietary review”</li>
<li>2013: “Diabetic dietary review”</li>
</ul>
<p>Based on this procedure, we will generate first occurrence event table for diabetes. First, subset the event table with any indications of diabetes to events with clear indications of diabetes.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="9.1-phenotype-outcome-events.html#cb177-1" aria-hidden="true" tabindex="-1"></a>diabetics_simple <span class="ot">&lt;-</span> </span>
<span id="cb177-2"><a href="9.1-phenotype-outcome-events.html#cb177-2" aria-hidden="true" tabindex="-1"></a>  diabetics_any <span class="sc">%&gt;%</span> </span>
<span id="cb177-3"><a href="9.1-phenotype-outcome-events.html#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(f.eid) <span class="sc">%&gt;%</span> </span>
<span id="cb177-4"><a href="9.1-phenotype-outcome-events.html#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">any</span>(code <span class="sc">%in%</span> dm_codes_confident)) <span class="sc">%&gt;%</span></span>
<span id="cb177-5"><a href="9.1-phenotype-outcome-events.html#cb177-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event_dt =</span> <span class="fu">as.Date</span>(event_dt)) <span class="sc">%&gt;%</span></span>
<span id="cb177-6"><a href="9.1-phenotype-outcome-events.html#cb177-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(f.eid,event_dt) <span class="sc">%&gt;%</span></span>
<span id="cb177-7"><a href="9.1-phenotype-outcome-events.html#cb177-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code></pre></div>
<p>Generate first occurrence diabetes events.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="9.1-phenotype-outcome-events.html#cb178-1" aria-hidden="true" tabindex="-1"></a>dm_firstoccur_pc <span class="ot">&lt;-</span> diabetics_simple <span class="sc">%&gt;%</span></span>
<span id="cb178-2"><a href="9.1-phenotype-outcome-events.html#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(f.eid) <span class="sc">%&gt;%</span> </span>
<span id="cb178-3"><a href="9.1-phenotype-outcome-events.html#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(event_dt) <span class="sc">%&gt;%</span> </span>
<span id="cb178-4"><a href="9.1-phenotype-outcome-events.html#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb178-5"><a href="9.1-phenotype-outcome-events.html#cb178-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(f.eid, event_dt)</span></code></pre></div>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="9.1-phenotype-outcome-events.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(diabetics_simple,<span class="st">&quot;generated_data/dm_pc.RDS&quot;</span>)</span>
<span id="cb179-2"><a href="9.1-phenotype-outcome-events.html#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dm_firstoccur_pc,<span class="st">&quot;generated_data/dm_firstoccur_pc.RDS&quot;</span>)</span></code></pre></div>
</div>
<div id="dr-1" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> DR</h3>
<p>Phenotype diabetic eye disease event table.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="9.1-phenotype-outcome-events.html#cb180-1" aria-hidden="true" tabindex="-1"></a>dr_pc <span class="ot">&lt;-</span> pc <span class="sc">%&gt;%</span> <span class="fu">filter</span>(code <span class="sc">%in%</span> dr_dict<span class="sc">$</span>code) <span class="sc">%&gt;%</span> </span>
<span id="cb180-2"><a href="9.1-phenotype-outcome-events.html#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(f.eid,event_dt) <span class="sc">%&gt;%</span> </span>
<span id="cb180-3"><a href="9.1-phenotype-outcome-events.html#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event_dt=</span><span class="fu">as.Date</span>(event_dt)) <span class="sc">%&gt;%</span> </span>
<span id="cb180-4"><a href="9.1-phenotype-outcome-events.html#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(f.eid,event_dt)</span></code></pre></div>
<p>Generate first occurrence diabetic eye disease event table.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="9.1-phenotype-outcome-events.html#cb181-1" aria-hidden="true" tabindex="-1"></a>dr_firstoccur_pc <span class="ot">&lt;-</span> dr_pc <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(f.eid) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(event_dt) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="9.1-phenotype-outcome-events.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dr_pc,<span class="st">&quot;generated_data/dr_pc.RDS&quot;</span>)</span>
<span id="cb182-2"><a href="9.1-phenotype-outcome-events.html#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dr_firstoccur_pc,<span class="st">&quot;generated_data/dr_firstoccur_pc.RDS&quot;</span>)</span></code></pre></div>
</div>
<div id="dkd-1" class="section level3" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> DKD</h3>
<p>Phenotype diabetic kidney disease event table.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="9.1-phenotype-outcome-events.html#cb183-1" aria-hidden="true" tabindex="-1"></a>kidney_disease_case_pc <span class="ot">&lt;-</span> </span>
<span id="cb183-2"><a href="9.1-phenotype-outcome-events.html#cb183-2" aria-hidden="true" tabindex="-1"></a>  pc <span class="sc">%&gt;%</span> <span class="fu">filter</span>(code <span class="sc">%in%</span> kidney_disease_case_dict<span class="sc">$</span>code) <span class="sc">%&gt;%</span> </span>
<span id="cb183-3"><a href="9.1-phenotype-outcome-events.html#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(f.eid,event_dt) <span class="sc">%&gt;%</span></span>
<span id="cb183-4"><a href="9.1-phenotype-outcome-events.html#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event_dt =</span> <span class="fu">as.Date</span>(event_dt)) <span class="sc">%&gt;%</span></span>
<span id="cb183-5"><a href="9.1-phenotype-outcome-events.html#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(f.eid,event_dt)</span></code></pre></div>
<p>Generate first occurrence diabetic kidney disease event table.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="9.1-phenotype-outcome-events.html#cb184-1" aria-hidden="true" tabindex="-1"></a>kidney_disease_case_firstoccur_pc <span class="ot">&lt;-</span> kidney_disease_case_pc <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(f.eid) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(event_dt) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="9.1-phenotype-outcome-events.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(kidney_disease_case_pc,<span class="st">&quot;generated_data/kidney_disease_case_pc.RDS&quot;</span>)</span>
<span id="cb185-2"><a href="9.1-phenotype-outcome-events.html#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(kidney_disease_case_firstoccur_pc,<span class="st">&quot;generated_data/kidney_disease_case_firstoccur_pc.RDS&quot;</span>)</span></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="9-phenotype-outcomes-pcp.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="9.2-phenotype-control-exclusion-events-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
